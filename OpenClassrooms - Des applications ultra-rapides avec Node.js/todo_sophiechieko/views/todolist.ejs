<!DOCTYPE html>
<html>
<head>
    <title>Application Todolist</title>
</head>
<body>
    <h1>Ma todolist</h1>
    <ul>
        <% todolist.forEach(function(nouvelleTache, index){ %>
        <li><a class="supression" href="todolist.ejs">✘</a> <%= nouvelleTache %> </li>
        <% }); %>
    </ul>
    <form action="/ajouter" method="post" id="addForm">
        <p>
            <label for="newtodo">Que dois-je faire ?</label>
            <input type="text" name="newtodo" id="newtodo" autofocus>
            <input type="submit">
        </p>
    </form>


    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        var socket = io.connect('http://localhost:8081');
            // Afficher les tâches
            socket.on('listeActuelle', function(todolist) {
                $('#todolist').empty();
                todolist.forEach(function(nouvelleTache, index) {
                    insererTache(nouvelleTache, index);
                });
            });

            // Quand l'utilisateur envoie avec le formulaire
            $('#addForm').submit(function(){
                var nouvelleTache = $('newtodo').val();
                socket.emit('ajoutTache', nouvelleTache);
                insererTache(nouvelleTache, index);
                $('#tache').val('').focus();
            });

            // Dès que la nouvelle tâche est dans le tableau todolist[], on l'affiche dans la liste
            socket.on('ajout', function(data) {
                insererTache(data.nouvelleTache, data.index);
            });
            function insererTache(nouvelleTache, index){
                $('#todolist').append('<% todolist.forEach(function(nouvelleTache, index){ %><li><a class="supression" href="todolist.ejs">✘</a> <%= nouvelleTache %> </li><% }); %>');
            }

            // Supprimer une tâche
            $('.suppression').on('click', function(){
                socket.emit('suppression', $(this).data('index'));
            });

    </script>
</body>
</html>
